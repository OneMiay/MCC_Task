# # MCC_Task

![Demo](https://github.com/OneMiay/MCC_Task/blob/master/img/demo.gif)

## Инструкция


**Для сборки решения из кода**
- Открыть файл *MCC_Task.sln* в Visual Studio 2022 и скомпилировать проект.
- С помощью компилятора GCC (Windows/MinGW): `gcc MCC_Task.c labview_bridge.c -lws2_32 -o MCC_Task.exe`




## Дополнительно

 - Основная функция в программе - **processSample()**. В этой функции
   поддерживается текущее состояние импульса и пик. При проходе уровня
   порога отмечается новый импульс, при обратном прохождении – импульс
   завершается и учитывается.
   
 - Соответствие ограничениям: описанный алгоритм выдаёт потоковые
   вычисления за постоянное время на отсчет и требует лишь нескольких
   переменных и массивов малой длины (счетчики, текущие параметры), что
   вписывается в 5 КБ RAM. Размер кода невелик (несколько десятков
   строк, без сложных библиотек) – легко уложится в 20 КБ. Использование
   <stdint.h> обеспечивает переносимость кода на 8-, 16- или 32-битные
   MCU.

> PS: Moгу написать прошивку для STM32F103RBT6

Email: i.milashin@gmail.com
Telegram: https://t.me/OMiay

## Вывод пиков импульсов в LabVIEW

В проект добавлен простой TCP-мост для отправки событий пиков в LabVIEW.

- Формат сообщения: `P,<amplitude>,<bin>\n` — положительный пик; `N,<amplitude>,<bin>\n` — отрицательный пик.
- Хост/порт по умолчанию: `127.0.0.1:6340`.
- В консоли можно включить/выключить отправку перед обработкой файла.

Как быстро собрать VI для отображения графиков:
1. В LabVIEW создайте VI и на блок-диаграмме добавьте `TCP Listen` (порт 6340) → `TCP Read` в цикле → `Match Pattern`/`Scan From String` для парсинга строки вида `\%s,%f,%d`.
2. Разделите поток по типу пика (`P`/`N`) и ведите два буфера массивов амплитуд (и/или бин-индексов).
3. Для онлайнового графика используйте два индикатора `Waveform Chart` или `XY Graph` — один для положительных, один для отрицательных.
4. По завершении — `TCP Close Connection`.

Примечание: если LabVIEW слушатель не запущен до старта программы, соединение может не установиться — в этом случае программа продолжит работу без отправки (в консоли будет предупреждение).

